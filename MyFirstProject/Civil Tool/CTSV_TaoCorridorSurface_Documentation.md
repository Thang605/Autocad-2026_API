# L?nh CTSV_TaoCorridorSurface - T?o Corridor Surface riêng bi?t

## ?? **M?c ?ích**
Tách bi?t ch?c n?ng t?o corridor surface kh?i l?nh v? tr?c ngang ??:
- **T?p trung ch?c n?ng**: M?i l?nh có m?t nhi?m v? c? th?
- **D? b?o trì**: Code rõ ràng, không ph?c t?p
- **Linh ho?t**: Có th? t?o corridor surface mà không c?n v? tr?c ngang
- **Tái s? d?ng**: S? d?ng corridor surface cho nhi?u m?c ?ích khác nhau

## ?? **Tính n?ng chính**

### **L?nh: `CTSV_TaoCorridorSurface`**

#### **1. Form Interface**
```
???????????????????????????????????????????????????????????
? 1. Ch?n tim ???ng                                       ?
? ?? Tim ???ng: [___________________] [Ch?n]             ?
???????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????
? 2. C?u hình Corridor Surface                           ?
? ?? T?o Top Surface     Tên: [Top]    Style: [Dropdown] ?
? ?? T?o Datum Surface   Tên: [Datum]  Style: [Dropdown] ?
? ?? Tên surface theo ??nh d?ng: [AlignmentName]-L_Top   ?
? ?? L?u ý: C?n c?u hình mask và link codes th? công    ?
???????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????
? 3. Tùy ch?n                                             ?
? ?? T? ??ng thêm vào Section Sources                    ?
? ?? Rebuild corridor sau khi t?o                        ?
???????????????????????????????????????????????????????????

                        [T?o Surface] [H?y]
```

#### **2. Workflow**
1. **Ch?n Alignment**: Alignment ph?i có corridor liên k?t
2. **C?u hình Surface**: Ch?n lo?i surface và style
3. **Tùy ch?n**: Thi?t l?p các option b? sung
4. **Th?c thi**: T?o surface và rebuild corridor
5. **H??ng d?n**: Hi?n th? b??c c?u hình chi ti?t

## ?? **Technical Implementation**

### **Core Functions**

#### **FindCorridorByAlignment()**
```csharp
// Tìm corridor d?a trên alignment
// 1. Ki?m tra baseline có ch?a alignment
// 2. Fallback: ki?m tra tên t??ng t?
// Return: ObjectId c?a corridor ho?c ObjectId.Null
```

#### **CreateCorridorSurface()**
```csharp
// T?o corridor surface v?i tên và style c? th?
// 1. Ki?m tra surface ?ã t?n t?i
// 2. Áp d?ng style t? form ho?c auto-detect
// 3. T?o surface và c?u hình c? b?n
// Return: ObjectId c?a surface ?ã t?o
```

#### **AddSurfacesToSectionSources()**
```csharp
// Thêm surface vào section sources (n?u có sample line group)
// 1. Ki?m tra sample line group t?n t?i
// 2. ?ánh d?u surface ?? s? d?ng trong section views
// 3. Thông báo h??ng d?n n?u ch?a có sample line group
```

### **Surface Naming Convention**
- **Top Surface**: `{AlignmentName}-L_Top`
- **Datum Surface**: `{AlignmentName}-L_Datum`
- **Ví d?**: Alignment "ROAD_01" ? "ROAD_01-L_Top", "ROAD_01-L_Datum"

### **Style Selection**
```csharp
Auto-detect Priority:
?? Top Surface ??????????????????????????
? 1. "Top Surface"                      ?
? 2. "Road Top"                         ?
? 3. "Corridor Top"                     ?
? 4. First available style             ?
?????????????????????????????????????????

?? Datum Surface ????????????????????????
? 1. "Datum Surface"                    ?
? 2. "Subgrade"                         ?
? 3. "Corridor Datum"                   ?
? 4. First available style             ?
?????????????????????????????????????????
```

## ?? **User Guide**

### **B??c 1: Chu?n b?**
- ? ??m b?o có corridor ???c t?o cho alignment
- ? Corridor ph?i có assembly v?i link codes phù h?p
- ? Alignment ph?i liên k?t v?i corridor

### **B??c 2: Ch?y l?nh**
1. Gõ `CTSV_TaoCorridorSurface` trong command line
2. Form s? m? ra
3. **Ch?n Alignment**: Click "Ch?n" và pick alignment t? drawing
4. **C?u hình Surface**:
   - ??/? Ch?n lo?i surface c?n t?o (Top/Datum)
   - ?? Ch?n Surface Style t? dropdown
   - ?? Tên surface s? t? ??ng theo convention
5. **Tùy ch?n**:
   - ?? "T? ??ng thêm vào Section Sources" (khuy?n ngh?)
   - ?? "Rebuild corridor sau khi t?o" (b?t bu?c)
6. Click **"T?o Surface"**

### **B??c 3: C?u hình chi ti?t (Th? công)**
Sau khi t?o surface, c?n c?u hình chi ti?t:

#### **1. M? Corridor Properties**
```
Toolspace > Prospector > Corridors > [Corridor Name] > Properties
Ho?c: Right-click corridor > Properties
```

#### **2. Tab "Surfaces"**
```
• Ch?n surface v?a t?o
• Click "Add Boundaries" ?? thêm boundaries  
• Thi?t l?p "Overhang Correction"
• C?u hình mask cho surface
```

#### **3. Link Codes Configuration**
```
Top Surface codes:
?? Pave (m?t ???ng nh?a)
?? Top (m?t trên)
?? Crown (??nh ???ng)
?? Shoulder (vai ???ng)
?? Curb_Top (??nh trotuar)

Datum Surface codes:
?? Datum (m?t chu?n)
?? Subgrade (l?p n?n)
?? Formation (m?t san l?p)
?? Base (l?p móng)
```

### **B??c 4: S? d?ng trong Section Views**
1. **T? ??ng**: Ch?y `CTSV_VeTracNgangThietKe` - surfaces s? xu?t hi?n trong danh sách
2. **Th? công**: Right-click surface > "Add as Section Source"

## ?? **L?u ý quan tr?ng**

### **?i?u ki?n tiên quy?t**
- ? **Corridor ph?i t?n t?i** tr??c khi t?o surface
- ? **Assembly ph?i có link codes** phù h?p v?i surface type
- ? **Alignment ph?i liên k?t** v?i corridor baseline

### **X? lý l?i**
```
? "Không tìm th?y corridor" 
   ? Ki?m tra corridor có baseline v?i alignment ?úng

? "Surface ?ã t?n t?i"
   ? Surface v?i tên convention ?ã có, thay ??i tên ho?c xóa

? "Không th? rebuild corridor"  
   ? Ki?m tra assembly và baseline configuration
```

### **Best Practices**
1. **T?o corridor surface tr??c** khi v? section views
2. **C?u hình link codes ngay** sau khi t?o surface
3. **Test rebuild corridor** tr??c khi s? d?ng trong production
4. **Backup project** tr??c khi th?c hi?n thay ??i l?n

## ?? **Integration v?i các l?nh khác**

### **V?i CTSV_VeTracNgangThietKe**
```
Workflow tích h?p:
1. CTSV_TaoCorridorSurface ? T?o corridor surfaces
2. C?u hình manual ? Link codes và boundaries  
3. CTSV_VeTracNgangThietKe ? V? section views v?i surfaces
```

### **V?i Section Views workflow**
```
Standard workflow:
1. T?o Alignment và Profile
2. T?o Assembly và Corridor
3. CTSV_TaoCorridorSurface ? T?o corridor surfaces
4. T?o Sample Line Groups
5. CTSV_VeTracNgangThietKe ? V? section views
```

## ?? **Output và Results**

### **Successful Execution**
```
? Command line output:
   • "?ã t?o Top Surface: ROAD_01-L_Top"
   • "?ã t?o Datum Surface: ROAD_01-L_Datum"  
   • "?ã rebuild corridor ?? t?o surfaces"
   • "Hoàn thành! ?ã t?o 2 corridor surface(s)"

? Created objects:
   • Corridor surfaces v?i tên convention
   • Surface styles ?ã ???c áp d?ng
   • Ready for manual configuration

? Detailed instructions:
   • Step-by-step manual configuration guide
   • Link codes recommendations  
   • Usage in section views guidance
```

## ?? **Benefits c?a vi?c tách riêng**

### **Separation of Concerns**
- ? **Single Responsibility**: M?i l?nh có m?t nhi?m v? c? th?
- ? **Easier Maintenance**: S?a l?i và c?p nh?t d? dàng h?n
- ? **Better Testing**: Test t?ng ch?c n?ng riêng bi?t

### **User Experience**
- ? **Focused Interface**: Form ch? t?p trung vào corridor surface
- ? **Flexible Workflow**: T?o surface khi nào c?n, không b?t bu?c
- ? **Clear Instructions**: H??ng d?n c? th? cho t?ng b??c

### **Technical Benefits**
- ? **Code Reusability**: Logic t?o surface có th? tái s? d?ng
- ? **Error Isolation**: L?i không ?nh h??ng ??n ch?c n?ng khác
- ? **Performance**: Không ph?i x? lý surface khi ch? c?n v? section

---

**?? Status**: ? **READY FOR USE**
**?? Documentation**: ? **COMPLETE**  
**?? Build**: ? **SUCCESSFUL**

*L?nh riêng bi?t giúp qu?n lý corridor surface hi?u qu? và linh ho?t h?n!*
